{
  "title": "GoodDayTaxi Monitoring (Unified)",
  "uid": "goodday-unified",
  "timezone": "browser",
  "refresh": "5s",
  "schemaVersion": 36,
  "version": 3,
  "panels": [
    {
      "type": "stat",
      "title": "서비스 응답 성공률 (%)",
      "datasource": "Prometheus",
      "targets": [
        {
          "expr": "(\n  sum(rate(http_server_requests_seconds_count{job!=\"\"}[1m]))\n  - sum(rate(http_server_requests_seconds_count{status!~\"2..\",job!=\"\"}[1m]))\n)\n/ sum(rate(http_server_requests_seconds_count{job!=\"\"}[1m])) * 100",
          "legendFormat": "Success Rate"
        }
      ],
      "gridPos": { "x": 0, "y": 0, "w": 4, "h": 4 }
    },
    {
      "type": "stat",
      "title": "오류율 (%)",
      "datasource": "Prometheus",
      "targets": [
        {
          "expr": "sum(rate(http_server_requests_seconds_count{status!~\"2..\",job!=\"\"}[1m]))\n/ sum(rate(http_server_requests_seconds_count{job!=\"\"}[1m])) * 100",
          "legendFormat": "Error Rate"
        }
      ],
      "gridPos": { "x": 4, "y": 0, "w": 4, "h": 4 }
    },
    {
      "type": "stat",
      "title": "초당 요청 수 (RPS)",
      "datasource": "Prometheus",
      "targets": [
        {
          "expr": "sum(rate(http_server_requests_seconds_count{job!=\"\"}[1m]))",
          "legendFormat": "RPS"
        }
      ],
      "gridPos": { "x": 8, "y": 0, "w": 4, "h": 4 }
    },
    {
      "type": "stat",
      "title": "평균 응답 시간 (ms)",
      "datasource": "Prometheus",
      "targets": [
        {
          "expr": "sum(rate(http_server_requests_seconds_sum{job!=\"\"}[1m]))\n/ sum(rate(http_server_requests_seconds_count{job!=\"\"}[1m])) * 1000",
          "legendFormat": "Avg Latency"
        }
      ],
      "gridPos": { "x": 12, "y": 0, "w": 4, "h": 4 }
    },

    {
      "type": "timeseries",
      "title": "HTTP 요청 수 (상세)",
      "datasource": "Prometheus",
      "targets": [
        {
          "expr": "rate(http_server_requests_seconds_count{job!=\"\"}[1m])",
          "legendFormat": "{{job}} {{method}} {{uri}} {{status}}"
        }
      ],
      "gridPos": { "x": 0, "y": 4, "w": 12, "h": 7 }
    },
    {
      "type": "timeseries",
      "title": "HTTP 응답 시간 (Latency)",
      "datasource": "Prometheus",
      "targets": [
        {
          "expr": "(rate(http_server_requests_seconds_sum{job!=\"\"}[1m])\n/ rate(http_server_requests_seconds_count{job!=\"\"}[1m])) * 1000",
          "legendFormat": "{{job}} {{method}} {{uri}}"
        }
      ],
      "gridPos": { "x": 12, "y": 4, "w": 12, "h": 7 }
    },

    {
      "type": "timeseries",
      "title": "JVM Heap 사용량",
      "datasource": "Prometheus",
      "targets": [
        {
          "expr": "jvm_memory_used_bytes{area=\"heap\",job!=\"\"}",
          "legendFormat": "{{job}} heap"
        }
      ],
      "gridPos": { "x": 0, "y": 11, "w": 12, "h": 7 }
    },
    {
      "type": "timeseries",
      "title": "JVM Non-Heap 사용량",
      "datasource": "Prometheus",
      "targets": [
        {
          "expr": "jvm_memory_used_bytes{area=\"nonheap\",job!=\"\"}",
          "legendFormat": "{{job}} nonheap"
        }
      ],
      "gridPos": { "x": 12, "y": 11, "w": 12, "h": 7 }
    },

    {
      "type": "timeseries",
      "title": "GC 시간 / GC 횟수",
      "datasource": "Prometheus",
      "targets": [
        { "expr": "rate(jvm_gc_pause_seconds_sum{job!=\"\"}[1m])", "legendFormat": "{{job}} GC Pause" },
        { "expr": "rate(jvm_gc_pause_seconds_count{job!=\"\"}[1m])", "legendFormat": "{{job}} GC Count" }
      ],
      "gridPos": { "x": 0, "y": 18, "w": 12, "h": 7 }
    },

    {
      "type": "timeseries",
      "title": "CPU 사용량 (%)",
      "datasource": "Prometheus",
      "targets": [
        { "expr": "system_cpu_usage{job!=\"\"}", "legendFormat": "{{job}} System" },
        { "expr": "process_cpu_usage{job!=\"\"}", "legendFormat": "{{job}} Process" }
      ],
      "gridPos": { "x": 12, "y": 18, "w": 12, "h": 7 }
    },

    {
      "type": "timeseries",
      "title": "스레드 수 (JVM Threads)",
      "datasource": "Prometheus",
      "targets": [
        { "expr": "jvm_threads_live_threads{job!=\"\"}", "legendFormat": "{{job}} live" },
        { "expr": "jvm_threads_daemon_threads{job!=\"\"}", "legendFormat": "{{job}} daemon" },
        { "expr": "jvm_threads_peak_threads{job!=\"\"}", "legendFormat": "{{job}} peak" }
      ],
      "gridPos": { "x": 0, "y": 25, "w": 12, "h": 7 }
    },

    {
      "type": "timeseries",
      "title": "HikariCP 커넥션 풀",
      "datasource": "Prometheus",
      "targets": [
        { "expr": "hikaricp_connections_active{job!=\"\"}", "legendFormat": "{{job}} Active" },
        { "expr": "hikaricp_connections_idle{job!=\"\"}", "legendFormat": "{{job}} Idle" },
        { "expr": "hikaricp_connections_pending{job!=\"\"}", "legendFormat": "{{job}} Pending" }
      ],
      "gridPos": { "x": 12, "y": 25, "w": 12, "h": 7 }
    },

    {
      "type": "timeseries",
      "title": "Redis 키 수 (db0)",
      "datasource": "Prometheus",
      "targets": [
        {
          "expr": "redis_db_keys{job=\"redis\",db=\"db0\"}",
          "legendFormat": "db0 keys"
        }
      ],
      "gridPos": { "x": 0, "y": 32, "w": 24, "h": 7 }
    }
  ]
}
