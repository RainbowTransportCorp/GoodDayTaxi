name: Smart Service Build

# =====================================================================
# ğŸ“Œ Trigger ì¡°ê±´
#   - PR ìƒì„±/ìˆ˜ì • ì‹œ (dev ë˜ëŠ” main ëŒ€ìƒìœ¼ë¡œ)
#   - dev / main ë¸Œëœì¹˜ì— ì§ì ‘ push ë°œìƒ ì‹œ
# =====================================================================
on:
  pull_request:
    branches: [dev, main]
  push:
    branches: [dev, main]

# =====================================================================
# ğŸ” 1. ë³€ê²½ëœ ì„œë¹„ìŠ¤ ìë™ ê°ì§€ Job
#   - ì–´ë–¤ ì„œë¹„ìŠ¤ê°€ ìˆ˜ì •ëëŠ”ì§€ íŒë‹¨í•´ì„œ ë¹Œë“œ ë²”ìœ„ë¥¼ ìµœì†Œí™”
#   - ê³µí†µ ëª¨ë“ˆ(common-core / common-jpa) ë³€ê²½ ì‹œ â†’ ì „ì²´ ì„œë¹„ìŠ¤ ë¹Œë“œ
# =====================================================================
jobs:
  detect-changes:
    name: Detect Changed Services
    runs-on: ubuntu-latest

    steps:
      # --------------------------------------------------------------
      # 1) ì½”ë“œ ì²´í¬ì•„ì›ƒ
      # --------------------------------------------------------------
      - name: Checkout Repository
        uses: actions/checkout@v3

      # --------------------------------------------------------------
      # 2) ë¹„êµ ê¸°ì¤€(base) ë¸Œëœì¹˜ ê²°ì •
      #    - PR  : base_ref (ì˜ˆ: dev, main)
      #    - push: í˜„ì¬ ref_name
      # --------------------------------------------------------------
      - name: Determine Base Branch
        id: base
        run: |
          if [ "${{ github.event_name }}" = "pull_request" ]; then
            echo "base_branch=${{ github.base_ref }}" >> $GITHUB_OUTPUT
          else
            echo "base_branch=${{ github.ref_name }}" >> $GITHUB_OUTPUT
          fi

      # --------------------------------------------------------------
      # 3) ë³€ê²½ëœ íŒŒì¼ ëª©ë¡ ì¶”ì¶œ
      #    - origin/<base> ì™€ HEAD ë¥¼ ë¹„êµ
      #    - merge-base ì—†ìœ¼ë©´(íˆìŠ¤í† ë¦¬ ëŠê¹€) â†’ ì „ì²´ ë³€ê²½(ALL) ë¡œ ì²˜ë¦¬
      # --------------------------------------------------------------

      - name: Get Changed Files
        id: changes
        run: |
          BASE=${{ steps.base.outputs.base_branch }}
          echo "ğŸ“Œ Base branch: $BASE"

          git fetch origin $BASE || true

          if git merge-base origin/$BASE HEAD >/dev/null 2>&1; then
            echo "ğŸ” merge-base found â†’ ì¼ë°˜ diff ìˆ˜í–‰"
            CHANGED=$(git diff --name-only origin/$BASE...HEAD)
          else
            echo "âš  merge-base ì—†ìŒ â†’ ì „ì²´ ë³€ê²½ìœ¼ë¡œ ê°„ì£¼ (ALL)"
            CHANGED="ALL"
          fi

          echo "ğŸ“„ Raw changed files:"
          echo "$CHANGED"

          # ----------------------------------------------------------
          #  ğŸ”¥ ë¬¸ì„œ/CI í…œí”Œë¦¿ ë³€ê²½ì€ ì„œë¹„ìŠ¤ ì˜í–¥ ì—†ìŒ â†’ í•„í„°ë§ ì¶”ê°€
          # ----------------------------------------------------------
          FILTERED=""
          for FILE in $CHANGED; do
            case $FILE in
              *.md) continue ;;
              README.md) continue ;;
              .github/*) continue ;;
              docs/*) continue ;;
            esac
            FILTERED="$FILTERED $FILE"
          done

          # ì•„ë¬´ ì„œë¹„ìŠ¤ì—ë„ ì˜í–¥ì´ ì—†ìœ¼ë©´ changed_files=NONE
          if [ -z "$FILTERED" ]; then
            echo "changed_files=NONE" >> $GITHUB_OUTPUT
            exit 0
          fi

          # í•„í„°ë§ëœ íŒŒì¼ë§Œ ì¶œë ¥
          echo "changed_files<<EOF" >> $GITHUB_OUTPUT
          echo "$FILTERED" >> $GITHUB_OUTPUT
          echo "EOF" >> $GITHUB_OUTPUT

      # --------------------------------------------------------------
      # 4) ë³€ê²½ëœ íŒŒì¼ ëª©ë¡ì„ ê¸°ë°˜ìœ¼ë¡œ ì„œë¹„ìŠ¤ ë‹¨ìœ„ ë³€ê²½ ì‚¬í•­ ê°ì§€
      #    - account-service, dispatch-service ë“± ë””ë ‰í† ë¦¬ ê¸°ì¤€
      #    - ê³µí†µ ëª¨ë“ˆ(common-core / common-jpa) ë³€ê²½ â†’ services=ALL
      # --------------------------------------------------------------
      - name: Detect Changed Services
        id: detect
        run: |
          FILES="${{ steps.changes.outputs.changed_files }}"

          # ì „ì²´ ë³€ê²½(ALL) í”Œë˜ê·¸ê°€ ì´ë¯¸ ì„¤ì •ëœ ê²½ìš°
          if [ "$FILES" = "ALL" ]; then
            echo "services=ALL" >> $GITHUB_OUTPUT
            exit 0
          fi

          SERVICES=""

          for FILE in $FILES; do
            case $FILE in
              account-service/*)   SERVICES="$SERVICES account-service" ;;
              dispatch-service/*)  SERVICES="$SERVICES dispatch-service" ;;
              trip-service/*)      SERVICES="$SERVICES trip-service" ;;
              payment-service/*)   SERVICES="$SERVICES payment-service" ;;
              support-service/*)   SERVICES="$SERVICES support-service" ;;
              gateway/*)           SERVICES="$SERVICES gateway" ;;
              server/*)            SERVICES="$SERVICES server" ;;
              common-core/*)       SERVICES="ALL" ;;  # ê³µí†µ ëª¨ë“ˆì€ ì „ì²´ ì˜í–¥
              common-jpa/*)        SERVICES="ALL" ;;
            esac
          done

          # ê³µí†µ ëª¨ë“ˆ ë³€ê²½ â†’ ì „ì²´ ì„œë¹„ìŠ¤ ë¹Œë“œ
          if [ "$SERVICES" = "ALL" ]; then
            echo "services=ALL" >> $GITHUB_OUTPUT
            exit 0
          fi

          # ê³µë°±/ì¤‘ë³µ ì œê±°
          SERVICES=$(echo "$SERVICES" | xargs -n1 | sort -u | xargs)

          # ì§„ì§œë¡œ ì•„ë¬´ ì„œë¹„ìŠ¤ë„ ì•ˆ ë°”ë€Œì—ˆìœ¼ë©´ NONE
          if [ -z "$SERVICES" ]; then
            SERVICES="NONE"
          fi

          echo "services=$SERVICES" >> $GITHUB_OUTPUT
          echo "ğŸ” Changed services: $SERVICES"

    # detect-changes Job ê²°ê³¼ë¥¼ build Job ìœ¼ë¡œ ë„˜ê¹€
    outputs:
      services: ${{ steps.detect.outputs.services }}

  # =====================================================================
  # ğŸ”§ 2. ì„œë¹„ìŠ¤ ë¹Œë“œ Job
  #   - ê³µí†µ ëª¨ë“ˆ ë¨¼ì € ë¹Œë“œ ë° Maven Local ì— ë°°í¬
  #   - ë³€ê²½ëœ ì„œë¹„ìŠ¤ë§Œ ì„ íƒì ìœ¼ë¡œ ë¹Œë“œ (Smart CI)
  #   - ê³µí†µ ëª¨ë“ˆ/ëŒ€ê·œëª¨ ë³€ê²½ ì‹œ ì „ì²´ ì„œë¹„ìŠ¤ ë¹Œë“œ
  # =====================================================================
  build:
    name: Build Services
    runs-on: ubuntu-latest
    needs: detect-changes

    steps:
      # --------------------------------------------------------------
      # 1) ì½”ë“œ ì²´í¬ì•„ì›ƒ
      # --------------------------------------------------------------
      - name: Checkout Repository
        uses: actions/checkout@v3

      # --------------------------------------------------------------
      # 2) JDK 17 ì„¤ì • (Gradle & Spring Boot ë¹Œë“œë¥¼ ìœ„í•œ ê¸°ë³¸ ëŸ°íƒ€ì„)
      # --------------------------------------------------------------
      - name: Set up JDK 17
        uses: actions/setup-java@v4
        with:
          distribution: "temurin"
          java-version: "17"

      name: Smart Service Build

# =====================================================================
# ğŸ“Œ Trigger ì¡°ê±´
#   - PR ìƒì„±/ìˆ˜ì • ì‹œ (dev ë˜ëŠ” main ëŒ€ìƒìœ¼ë¡œ)
#   - dev / main ë¸Œëœì¹˜ì— ì§ì ‘ push ë°œìƒ ì‹œ
# =====================================================================
on:
  pull_request:
    branches: [dev, main]
  push:
    branches: [dev, main]

# =====================================================================
# ğŸ” 1. ë³€ê²½ëœ ì„œë¹„ìŠ¤ ìë™ ê°ì§€ Job
#   - ì–´ë–¤ ì„œë¹„ìŠ¤ê°€ ìˆ˜ì •ëëŠ”ì§€ íŒë‹¨í•´ì„œ ë¹Œë“œ ë²”ìœ„ë¥¼ ìµœì†Œí™”
#   - ê³µí†µ ëª¨ë“ˆ(common-core / common-jpa) ë³€ê²½ ì‹œ â†’ ì „ì²´ ì„œë¹„ìŠ¤ ë¹Œë“œ
# =====================================================================
jobs:
  detect-changes:
    name: Detect Changed Services
    runs-on: ubuntu-latest

    steps:
      # --------------------------------------------------------------
      # 1) ì½”ë“œ ì²´í¬ì•„ì›ƒ
      # --------------------------------------------------------------
      - name: Checkout Repository
        uses: actions/checkout@v3

      # --------------------------------------------------------------
      # 2) ë¹„êµ ê¸°ì¤€(base) ë¸Œëœì¹˜ ê²°ì •
      #    - PR  : base_ref (ì˜ˆ: dev, main)
      #    - push: í˜„ì¬ ref_name
      # --------------------------------------------------------------
      - name: Determine Base Branch
        id: base
        run: |
          if [ "${{ github.event_name }}" = "pull_request" ]; then
            echo "base_branch=${{ github.base_ref }}" >> $GITHUB_OUTPUT
          else
            echo "base_branch=${{ github.ref_name }}" >> $GITHUB_OUTPUT
          fi

      # --------------------------------------------------------------
      # 3) ë³€ê²½ëœ íŒŒì¼ ëª©ë¡ ì¶”ì¶œ
      #    - origin/<base> ì™€ HEAD ë¥¼ ë¹„êµ
      #    - merge-base ì—†ìœ¼ë©´(íˆìŠ¤í† ë¦¬ ëŠê¹€) â†’ ì „ì²´ ë³€ê²½(ALL) ë¡œ ì²˜ë¦¬
      # --------------------------------------------------------------

      - name: Get Changed Files
        id: changes
        run: |
          BASE=${{ steps.base.outputs.base_branch }}
          echo "ğŸ“Œ Base branch: $BASE"

          git fetch origin $BASE || true

          if git merge-base origin/$BASE HEAD >/dev/null 2>&1; then
            echo "ğŸ” merge-base found â†’ ì¼ë°˜ diff ìˆ˜í–‰"
            CHANGED=$(git diff --name-only origin/$BASE...HEAD)
          else
            echo "âš  merge-base ì—†ìŒ â†’ ì „ì²´ ë³€ê²½ìœ¼ë¡œ ê°„ì£¼ (ALL)"
            CHANGED="ALL"
          fi

          echo "ğŸ“„ Raw changed files:"
          echo "$CHANGED"

          # ----------------------------------------------------------
          #  ğŸ”¥ ë¬¸ì„œ/CI í…œí”Œë¦¿ ë³€ê²½ì€ ì„œë¹„ìŠ¤ ì˜í–¥ ì—†ìŒ â†’ í•„í„°ë§ ì¶”ê°€
          # ----------------------------------------------------------
          FILTERED=""
          for FILE in $CHANGED; do
            case $FILE in
              *.md) continue ;;
              README.md) continue ;;
              .github/*) continue ;;
              docs/*) continue ;;
            esac
            FILTERED="$FILTERED $FILE"
          done

          # ì•„ë¬´ ì„œë¹„ìŠ¤ì—ë„ ì˜í–¥ì´ ì—†ìœ¼ë©´ changed_files=NONE
          if [ -z "$FILTERED" ]; then
            echo "changed_files=NONE" >> $GITHUB_OUTPUT
            exit 0
          fi

          # í•„í„°ë§ëœ íŒŒì¼ë§Œ ì¶œë ¥
          echo "changed_files<<EOF" >> $GITHUB_OUTPUT
          echo "$FILTERED" >> $GITHUB_OUTPUT
          echo "EOF" >> $GITHUB_OUTPUT

      # --------------------------------------------------------------
      # 4) ë³€ê²½ëœ íŒŒì¼ ëª©ë¡ì„ ê¸°ë°˜ìœ¼ë¡œ ì„œë¹„ìŠ¤ ë‹¨ìœ„ ë³€ê²½ ì‚¬í•­ ê°ì§€
      #    - account-service, dispatch-service ë“± ë””ë ‰í† ë¦¬ ê¸°ì¤€
      #    - ê³µí†µ ëª¨ë“ˆ(common-core / common-jpa) ë³€ê²½ â†’ services=ALL
      # --------------------------------------------------------------
      - name: Detect Changed Services
        id: detect
        run: |
          FILES="${{ steps.changes.outputs.changed_files }}"

          # ì „ì²´ ë³€ê²½(ALL) í”Œë˜ê·¸ê°€ ì´ë¯¸ ì„¤ì •ëœ ê²½ìš°
          if [ "$FILES" = "ALL" ]; then
            echo "services=ALL" >> $GITHUB_OUTPUT
            exit 0
          fi

          SERVICES=""

          for FILE in $FILES; do
            case $FILE in
              account-service/*)   SERVICES="$SERVICES account-service" ;;
              dispatch-service/*)  SERVICES="$SERVICES dispatch-service" ;;
              trip-service/*)      SERVICES="$SERVICES trip-service" ;;
              payment-service/*)   SERVICES="$SERVICES payment-service" ;;
              support-service/*)   SERVICES="$SERVICES support-service" ;;
              gateway/*)           SERVICES="$SERVICES gateway" ;;
              server/*)            SERVICES="$SERVICES server" ;;
              common-core/*)       SERVICES="ALL" ;;  # ê³µí†µ ëª¨ë“ˆì€ ì „ì²´ ì˜í–¥
              common-jpa/*)        SERVICES="ALL" ;;
            esac
          done

          # ê³µí†µ ëª¨ë“ˆ ë³€ê²½ â†’ ì „ì²´ ì„œë¹„ìŠ¤ ë¹Œë“œ
          if [ "$SERVICES" = "ALL" ]; then
            echo "services=ALL" >> $GITHUB_OUTPUT
            exit 0
          fi

          # ê³µë°±/ì¤‘ë³µ ì œê±°
          SERVICES=$(echo "$SERVICES" | xargs -n1 | sort -u | xargs)

          # ì§„ì§œë¡œ ì•„ë¬´ ì„œë¹„ìŠ¤ë„ ì•ˆ ë°”ë€Œì—ˆìœ¼ë©´ NONE
          if [ -z "$SERVICES" ]; then
            SERVICES="NONE"
          fi

          echo "services=$SERVICES" >> $GITHUB_OUTPUT
          echo "ğŸ” Changed services: $SERVICES"

    # detect-changes Job ê²°ê³¼ë¥¼ build Job ìœ¼ë¡œ ë„˜ê¹€
    outputs:
      services: ${{ steps.detect.outputs.services }}

  # =====================================================================
  # ğŸ”§ 2. ì„œë¹„ìŠ¤ ë¹Œë“œ Job
  #   - ê³µí†µ ëª¨ë“ˆ ë¨¼ì € ë¹Œë“œ ë° Maven Local ì— ë°°í¬
  #   - ë³€ê²½ëœ ì„œë¹„ìŠ¤ë§Œ ì„ íƒì ìœ¼ë¡œ ë¹Œë“œ (Smart CI)
  #   - ê³µí†µ ëª¨ë“ˆ/ëŒ€ê·œëª¨ ë³€ê²½ ì‹œ ì „ì²´ ì„œë¹„ìŠ¤ ë¹Œë“œ
  # =====================================================================
  build:
    name: Build Services
    runs-on: ubuntu-latest
    needs: detect-changes

    steps:
      # --------------------------------------------------------------
      # 1) ì½”ë“œ ì²´í¬ì•„ì›ƒ
      # --------------------------------------------------------------
      - name: Checkout Repository
        uses: actions/checkout@v3

      # --------------------------------------------------------------
      # 2) JDK 17 ì„¤ì • (Gradle & Spring Boot ë¹Œë“œë¥¼ ìœ„í•œ ê¸°ë³¸ ëŸ°íƒ€ì„)
      # --------------------------------------------------------------
      - name: Set up JDK 17
        uses: actions/setup-java@v4
        with:
          distribution: "temurin"
          java-version: "17"

      # --------------------------------------------------------------
      # 3) Gradle & Maven ìºì‹œ ì„¤ì •
      #    - Gradle wrapper / dependency / Maven Local ìºì‹±
      #    - ë¹Œë“œ ì†ë„ ê°œì„  íš¨ê³¼ í¼
      # --------------------------------------------------------------
      - name: Setup Gradle & Maven Cache
        uses: actions/cache@v3
        with:
          path: |
            ~/.gradle/caches
            ~/.gradle/wrapper
            ~/.m2
          key: gradle-${{ runner.os }}-${{ hashFiles('**/*.gradle*', '**/gradle-wrapper.properties') }}

      # --------------------------------------------------------------
      # 4) ê³µí†µ ëª¨ë“ˆ(common-core) ë¹Œë“œ ë° Maven Local ë°°í¬
      #    - ê° ì„œë¹„ìŠ¤ì—ì„œ com.gooddaytaxi:common-core:0.0.1-SNAPSHOT
      #      ì˜ì¡´ì„±ì„ ì°¾ì„ ìˆ˜ ìˆë„ë¡ ì„ í–‰ ì‘ì—…
      # --------------------------------------------------------------
      - name: Build common-core
        run: |
          if [ -d "common-core" ]; then
            echo "ğŸ”§ Building common-core..."
            chmod +x common-core/gradlew || true
            (cd common-core && ./gradlew clean build publishToMavenLocal --no-daemon)
          else
            echo "â„¹ common-core module not found. Skipping."
          fi

      # --------------------------------------------------------------
      # 5) ê³µí†µ ëª¨ë“ˆ(common-jpa) ë¹Œë“œ ë° Maven Local ë°°í¬
      # --------------------------------------------------------------
      - name: Build common-jpa
        run: |
          if [ -d "common-jpa" ]; then
            echo "ğŸ”§ Building common-jpa..."
            chmod +x common-jpa/gradlew || true
            (cd common-jpa && ./gradlew clean build publishToMavenLocal --no-daemon)
          else
            echo "â„¹ common-jpa module not found. Skipping."
          fi

      # --------------------------------------------------------------
      # 6) ë³€ê²½ëœ ì„œë¹„ìŠ¤ë§Œ ë¹Œë“œ (Smart Build)
      #    - detect-changes Job ê²°ê³¼ê°€
      #      - 'ALL'  ì´ ì•„ë‹ˆê³ 
      #      - 'NONE' ë„ ì•„ë‹ ë•Œ
      # --------------------------------------------------------------
      - name: Build Changed Services
        if: needs.detect-changes.outputs.services != 'ALL' && needs.detect-changes.outputs.services != 'NONE'
        run: |
          SERVICES="${{ needs.detect-changes.outputs.services }}"
          echo "ğŸš€ Building changed services: $SERVICES"

          for SERVICE in $SERVICES; do
            echo "ğŸ”¨ Building $SERVICE ..."
            # ê° ì„œë¹„ìŠ¤ì˜ gradlew ì— ì‹¤í–‰ ê¶Œí•œ ë¶€ì—¬ í›„ ë¹Œë“œ
            chmod +x $SERVICE/gradlew || true
            (cd $SERVICE && ./gradlew clean build --no-daemon)
          done

      # --------------------------------------------------------------
      # 7) ì „ì²´ ì„œë¹„ìŠ¤ ë¹Œë“œ
      #    - ê³µí†µ ëª¨ë“ˆ ë³€ê²½ ë˜ëŠ” merge-base ì—†ìŒìœ¼ë¡œ ALL ì²˜ë¦¬ëœ ê²½ìš°
      # --------------------------------------------------------------
      - name: Build ALL Services
        if: needs.detect-changes.outputs.services == 'ALL'
        run: |
          SERVICES="account-service dispatch-service trip-service payment-service support-service gateway server"
          echo "ğŸš€ Building ALL services: $SERVICES"

          for SERVICE in $SERVICES; do
            if [ -d "$SERVICE" ]; then
              echo "ğŸ”¨ Building $SERVICE ..."
              chmod +x $SERVICE/gradlew || true
              (cd $SERVICE && ./gradlew clean build --no-daemon)
            else
              echo "â„¹ $SERVICE ë””ë ‰í† ë¦¬ê°€ ì—†ì–´ ë¹Œë“œ ìŠ¤í‚µ."
            fi
          done

      # --------------------------------------------------------------
      # 8) ë³€ê²½ëœ ì„œë¹„ìŠ¤ê°€ ì „í˜€ ì—†ëŠ” ê²½ìš° (ë¬¸ì„œë§Œ ë°”ë€ ê²½ìš° ë“±)
      # --------------------------------------------------------------
      - name: No Backend Changes
        if: needs.detect-changes.outputs.services == 'NONE'
        run: echo "ğŸŸ¡ No backend service changes detected â€” Build skipped."


      # --------------------------------------------------------------
      # 6) ë³€ê²½ëœ ì„œë¹„ìŠ¤ë§Œ ë¹Œë“œ (Smart Build)
      #    - detect-changes Job ê²°ê³¼ê°€
      #      - 'ALL'  ì´ ì•„ë‹ˆê³ 
      #      - 'NONE' ë„ ì•„ë‹ ë•Œ
      # --------------------------------------------------------------
      - name: Build Changed Services
        if: needs.detect-changes.outputs.services != 'ALL' && needs.detect-changes.outputs.services != 'NONE'
        run: |
          SERVICES="${{ needs.detect-changes.outputs.services }}"
          echo "ğŸš€ Building changed services: $SERVICES"

          for SERVICE in $SERVICES; do
            echo "ğŸ”¨ Building $SERVICE ..."
            # ê° ì„œë¹„ìŠ¤ì˜ gradlew ì— ì‹¤í–‰ ê¶Œí•œ ë¶€ì—¬ í›„ ë¹Œë“œ
            chmod +x $SERVICE/gradlew || true
            (cd $SERVICE && ./gradlew clean build --no-daemon)
          done

      # --------------------------------------------------------------
      # 7) ì „ì²´ ì„œë¹„ìŠ¤ ë¹Œë“œ
      #    - ê³µí†µ ëª¨ë“ˆ ë³€ê²½ ë˜ëŠ” merge-base ì—†ìŒìœ¼ë¡œ ALL ì²˜ë¦¬ëœ ê²½ìš°
      # --------------------------------------------------------------
      - name: Build ALL Services
        if: needs.detect-changes.outputs.services == 'ALL'
        run: |
          SERVICES="account-service dispatch-service trip-service payment-service support-service gateway server"
          echo "ğŸš€ Building ALL services: $SERVICES"

          for SERVICE in $SERVICES; do
            if [ -d "$SERVICE" ]; then
              echo "ğŸ”¨ Building $SERVICE ..."
              chmod +x $SERVICE/gradlew || true
              (cd $SERVICE && ./gradlew clean build --no-daemon)
            else
              echo "â„¹ $SERVICE ë””ë ‰í† ë¦¬ê°€ ì—†ì–´ ë¹Œë“œ ìŠ¤í‚µ."
            fi
          done

      # --------------------------------------------------------------
      # 8) ë³€ê²½ëœ ì„œë¹„ìŠ¤ê°€ ì „í˜€ ì—†ëŠ” ê²½ìš° (ë¬¸ì„œë§Œ ë°”ë€ ê²½ìš° ë“±)
      # --------------------------------------------------------------
      - name: No Backend Changes
        if: needs.detect-changes.outputs.services == 'NONE'
        run: echo "ğŸŸ¡ No backend service changes detected â€” Build skipped."
